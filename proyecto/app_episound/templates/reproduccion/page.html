{% extends 'index.html' %}
{% block content %}
  <div class="flex flex-row space-x-4 bg-transparent">
    <!-- Sección de la izquierda -->
    <div class="flex flex-col w-3/5 bg-black">
      <button id="random-btn" class="text-white px-4 py-2 rounded-md ">Random</button>
      <!-- Información de la canción actual -->
      <div class="pl-4 py-4 bg-black rounded-lg text-white">
        <div class="w-full">
          <nav class="w-3/12 flex flex-row gap-x-64 mb-2 py-2 justify-start">
            <h1 class="px-3 pb-1 border-b-2 border-b-primary font-bold text-primary">Sonando</h1>
          </nav>
          <div class="flex flex-row pr-4">
            <div class="flex items-center justify-between w-full border-2 border-primary p-4 bg-black text-white">
              <div class="flex items-center space-x-4">
                <div class="min-w-12 min-h-12 w-12 h-12 bg-fond flex items-center justify-center text-white text-xl">
                </div>
                <div class="flex flex-col">
                  <span class="font-bold text-primary">{{ current_song.track_name }}</span>
                  <span class="text-gray-400">{{ current_song.artist_name }}</span>
                </div>
              </div>
              <div class="flex items-center space-x-4">
                <span class="font-bold text-red-400"></span>
              </div>  
            </div>
          </div>
        </div>
      </div>
      <!-- Lista de canciones -->
      <div class="max-w-3xl mb-8 w-full flex items-center justify-center flex-col pl-4">
        <div class="w-full">
          <nav class="w-44 flex flex-row gap-x-64 mb-2 py-2 justify-start">
            <h1 class="w-full px-3 mr-3 pb-1 border-b-2 border-white font-bold">Siguiente Canción</h1>
          </nav>
        </div>
        <div class="max-w-3xl w-full overflow-y-auto space-y-4 mx-40 pr-4 pb-4 flex flex-col" style="height: calc(4 * 6rem + 4 * 1rem);">
          <ul class="song-list space-y-4" id="songList">
            {% for cancion in canciones %}
            <li class="song-item flex flex-row items-center justify-between border-2 border-white p-4 bg-black text-white" draggable="true">
              <div class="flex items-center space-x-4">
                <button class="text-black bg-white w-9 h-9"> = </button>
                <div class="min-w-12 min-h-12 w-12 h-12 bg-white flex items-center justify-center text-white text-xl">
                  🎵
                </div>
                <div class="flex flex-col">
                  <span class="font-bold text-white">{{ cancion.track_name }}</span>
                  <span class="text-gray-400">{{ cancion.artist_name }}</span>
                </div>
              </div>
              <div class="flex items-center space-x-4">
                <span id="duration-{{ forloop.counter }}" class="font-bold text-white">{{ cancion.track_duration_ms }}</span>
              </div>
            </li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div> 
    <!-- Sección de la derecha -->
    <div class="flex flex-col w-2/5 border-l-2 border-l-white p-4">
      <!-- Información de la canción actual -->
      <div class="text-primary font-bold p-2">
        <p class="text-2xl">{{ current_song.track_name }}</p>
        <p class="text-xl">{{ current_song.artist_name }}</p>
      </div>
      <!-- Imagen de la canción y botones -->
      <div class="w-full flex flex-col items-center justify-center p-4">
        <div class="bg-fond h-44 w-44 flex items-center justify-center">
          <!-- Imagen o información adicional aquí -->
        </div>
        <div class="w-full p-2 flex justify-center mt-4 border-2 border-white">
          <div class="flex space-x-4 gap-10 font-bold">
            <button id="prev-song-btn" class="text-white px-4 py-2 rounded-md ">Anterior</button>
            <button id="play-btn" class="text-white px-4 py-2 rounded-md ">Play</button>
            <button id="next-song-btn" class="text-white px-4 py-2 rounded-md ">Siguiente</button>
          </div>
        </div>
      </div>
      <!-- Información adicional de la canción -->
      <div class="w-full border-t-2 border-t-white mt-4 my-4">
        <div class="mx-4 mt-4 space-y-4">
          <p class="text-primary text-xl font-bold mt-2">Información sobre la canción:</p>
          <div class="mx-4 font-bold text-base">
            <h1 id="current-duration-info" class="text-xl">Duración: {{ current_song.track_duration_ms }}</h1>
          </div>
          <div class="mx-4 font-bold text-base">
            <h1 class="text-xl">Popularidad: {{ current_song.track_popularity }} </h1>
          </div>
          <div class="mx-4 font-bold text-base">
            <h1 class="text-xl">Año: {{ current_song.track_year }} </h1>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de alerta -->
  <div id="alert-modal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50 hidden">
    <div class="bg-black p-6 rounded-lg shadow-lg text-center border-primary-alert">
      <div id="alert-message" class="text-white font-bold"></div>
      <button id="close-alert" class="mt-4 px-4 py-2 bg-fuchsia-800 text-white rounded-md">Cerrar</button>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const alertModal = document.getElementById('alert-modal');
      const alertMessage = document.getElementById('alert-message');
      const showAlert = "{{ show_alert }}";
      const alertText = "{{ alert_message }}";

      if (showAlert === "True") {
        alertMessage.textContent = alertText;
        alertModal.classList.remove('hidden');
      }

      document.getElementById('close-alert').addEventListener('click', function() {
        alertModal.classList.add('hidden');
      });

      // Formatear la duración de la canción actual
      const currentDurationElement = document.getElementById('current-duration');
      if (currentDurationElement) {
        formatDuration(currentDurationElement);
      }

      const currentDurationInfoElement = document.getElementById('current-duration-info');
      if (currentDurationInfoElement) {
        formatDuration(currentDurationInfoElement);
      }

      // Formatear la duración de todas las canciones en la lista
      {% for cancion in canciones %}
        const durationElement{{ forloop.counter }} = document.getElementById('duration-{{ forloop.counter }}');
        if (durationElement{{ forloop.counter }}) {
          formatDuration(durationElement{{ forloop.counter }});
        }
      {% endfor %}
    });

    function formatDuration(element) {
      const ms = parseInt(element.textContent.match(/\d+/)[0], 10);

      const minutes = Math.floor(ms / 60000);
      const seconds = Math.floor((ms % 60000) / 1000);

      // Formatear el texto de duración
      const formattedDuration = `${minutes}:${seconds.toString().padStart(2, '0')}`;

      element.textContent = `Duración: ${formattedDuration}`;
    }
    
    document.getElementById('prev-song-btn').addEventListener('click', function(event) {
      event.preventDefault();
      if (!document.getElementById('alert-modal').classList.contains('hidden')) {
        return; // No navega si el modal está visible
      }
      window.location.href = "{% url 'prev_song' %}";
    });

    document.getElementById('next-song-btn').addEventListener('click', function(event) {
      event.preventDefault();
      if (!document.getElementById('alert-modal').classList.contains('hidden')) {
        return; // No navega si el modal está visible
      }
      window.location.href = "{% url 'next_song' %}";
    });

    document.getElementById('play-btn').addEventListener('click', function(event) {
      event.preventDefault();
      if (!document.getElementById('alert-modal').classList.contains('hidden')) {
        return; // No navega si el modal está visible
      }
      window.location.href = "{% url 'play_song' %}", '_blank';
    });

    document.getElementById('random-btn').addEventListener('click', function(event) {
      event.preventDefault();
      if (!document.getElementById('alert-modal').classList.contains('hidden')) {
        return; // No navega si el modal está visible
      }
      window.location.href = "{% url 'random' %}";
    });

    document.addEventListener("DOMContentLoaded", function() {
      var durationElement = document.getElementById('duration');
  
      var ms = parseInt(durationElement.textContent.match(/\d+/)[0], 10);
  
      var minutes = Math.floor(ms / 60000);
      var seconds = Math.floor((ms % 60000) / 1000);
  
      // Formatear el texto de duración
      var formattedDuration = `Duración: ${minutes}:${seconds.toString().padStart(2, '0')}`;
  
      durationElement.textContent = formattedDuration;
    });
    
    document.addEventListener('DOMContentLoaded', () => {
      const songList = document.getElementById('songList');
      let draggedItem = null;
  
      songList.addEventListener('dragstart', (event) => {
          // Ensure the dragged item is the <li> element
          draggedItem = event.target.closest('.song-item');
          draggedItem.style.opacity = 0.4;
      });
  
      songList.addEventListener('dragend', (event) => {
          if (draggedItem) {
              draggedItem.style.opacity = '';
          }
      });
  
      songList.addEventListener('dragover', (event) => {
          event.preventDefault();
      });
  
      songList.addEventListener('dragenter', (event) => {
          const targetItem = event.target.closest('.song-item');
          if (targetItem && targetItem !== draggedItem) {
              targetItem.style.border = '1px solid #aaa';
          }
      });
  
      songList.addEventListener('dragleave', (event) => {
          const targetItem = event.target.closest('.song-item');
          if (targetItem && targetItem !== draggedItem) {
              targetItem.style.border = '';
          }
      });
  
      songList.addEventListener('drop', (event) => {
          event.preventDefault();
          const targetItem = event.target.closest('.song-item');
          if (targetItem && targetItem !== draggedItem) {
              targetItem.style.border = '';
              const items = Array.from(songList.children);
              const draggedIndex = items.indexOf(draggedItem);
              const targetIndex = items.indexOf(targetItem);
  
              if (draggedIndex < targetIndex) {
                  songList.insertBefore(draggedItem, targetItem.nextSibling);
              } else {
                  songList.insertBefore(draggedItem, targetItem);
              }
          }
    });
});

  
  </script>
{% endblock %}
